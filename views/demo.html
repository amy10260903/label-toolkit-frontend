<!DOCTYPE html>
<html>
	<head>
		<title> Label Toolkit for JPTW Project | AHG</title>
		<link rel="icon" href="/assets/images/favicon/toolkit.ico"/>
		<!-- <link rel="shortcut icon" href="/assets/images/icon/toolkit-01.png" type="image/x-icon" /> -->

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>

		<!-- Wave Surfer -->
		<script src="https://unpkg.com/wavesurfer.js"></script>
		<script src="https://unpkg.com/wavesurfer.js/dist/plugin/wavesurfer.spectrogram.min.js"></script>

		<!-- Load YAML -->
		<script src="/lib/js-yaml/js-yaml.min.js"></script>	
		
		<!-- Resize Sensor -->
		<script src="/lib/css-element-queries/ResizeSensor.js"></script>
		<script src="/lib/css-element-queries/ElementQueries.js"></script>
		
		<!-- Custom Selectbox -->
		<script src="/lib/jquery-nice-select-1.1.0/jquery.js"></script> 
		<script src="/lib/jquery-nice-select-1.1.0/jquery.nice-select.js"></script>
		<link rel="stylesheet" href="/lib/jquery-nice-select-1.1.0/nice-select.css">

		<!-- Loader.css -->
		<script src="/lib/loaders.css/loaders.css.js"></script> 
		<link rel="stylesheet" href="/lib/loaders.css/loaders.min.css">
		
		<!-- Style -->
		<link rel="stylesheet" href="/css/style.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body>
		<section id="section-title">
			<h1>Label Toolkit for JP-TW Project</h1>
		</section>
		<section id="section-selection">
			<div class="container">
				<div class="content">
					<form id="selection-form">
						<div style="margin-left: 20px; width: 30%; float:left;">
							<div class="label">Dataset</div>
					        <div class="custom-select">
					        	<select id="select-location">
					        		<option value="" disabled selected>Source</option>
					        	</select>
					        </div>
				    	</div>
				        <div style="margin-left: 20px; width: 30%; float:left;">
							<!-- <div class="label">Search</div>
					        <div class="custom-select">
					        	<select id="select-place" onchange="updateResult()">
					        		<option value="" disabled selected>Target</option>
					        	</select>
					        </div> -->
					        <div class="label">Search</div>
					        <div class="custom-input" id="custom-upload">
					        	<input type="file" id="upload-btn" accept="audio/*" />
								<label for="upload-btn" id="upload-label">Choose file</label>
							</div>
				    	</div>
				    	<div style="width: auto; float:right;">
					    	<div class="custom-input" id="custom-submit">
						        <input type="button" onclick="Recognize()" id="submit"/>
								<label for="submit">Start</label>
							</div>
						</div>
			    	</form>
			    	<div style="margin-left: 20px; width: 30%; float:left; display: none;" id="candidate">
						<div class="label">Candidate</div>
				        <div class="custom-select">
				        	<select id="select-soundsource" onchange="updateSpectrum()">
				        		<option value="" disabled selected>Result</option>
				        	</select>
				        </div>
			    	</div>
		    	</div>
		    </div>
		</section>
		<section id="section-waveform">
			<div class="wrapper">
		        <div id="waveform"></div>
		        <div id="wave-spectrogram"></div>
		        <!-- Create action buttons -->
		        <input type="button" id="btn-play" value="Play" disabled="disabled"/>
		        <input type="button" id="btn-pause" value="Pause" disabled="disabled"/>
		        <input type="button" id="btn-stop" value="Stop" disabled="disabled" />
		        <!-- <input type="button" id="btn-add" value="Load"/> -->
		        <input type="range" id="slider" min="0" max="100" step="1" value="50">
		        <div id="content-tag"></div>
		        <div id="content-block"></div>
		    </div>
		</section>
		<section id="section-loader">
			<div class="container">
				<div class="loader-inner line-scale-pulse-out"></div>  
				<p class="loading">Analysing</p>
			</div>
		</section>
    </body>
    <script type="text/javascript">
    	$('.loader-inner').loaders();
    	const upload_btn = document.getElementById('upload-btn');
    	const upload_label = document.getElementById('upload-label');
    	upload_btn.addEventListener('change', function(){
  			upload_label.textContent = this.files[0].name
		})

    	function Recognize() {
    		console.log('>>> submit!');
    		document.getElementById('section-loader').style.display = 'block';
    		let mainFormData = new FormData();
    		let location = document.getElementsByClassName("current")[0].innerHTML;
    		let file = upload_btn.files[0];
    		mainFormData.append('file', file);
    		mainFormData.append('category', location);
    		axios({
    			method: 'post',
    			url: 'http://localhost:8000/api/main/recognize/',
    			data: mainFormData,
    			headers: {'Content-Type': 'multipart/form-data' }
    			})
    			.then(function (response) {
    				console.log(response);
    				document.getElementById('section-loader').style.display = 'none';
    				document.getElementById('selection-form').style.display = 'none';
    				document.getElementById('candidate').style.display = 'block';
    				parseResult(response);
    			})
    			.catch(function (response) {
    				console.log(response);
    			});
    	}

    	function parseResult(response) {
    		let soundsource = document.getElementById('select-soundsource');
    		let data = response.data.results;
    		for (i=0; i<data.length; i++) {
    			let option = document.createElement("option");
    			option.text = data[i].song_name;
    			soundsource.add(option);	
    			results[data[i].song_name] = data[i].offset_seconds;
    		}
    		$('select').niceSelect('update');
    	}
    </script>
    <script src="/js/demo/parse.js"></script>
    <script src="/js/demo/spectrum.js"></script>
    <script src="/js/demo/event.js"></script>
    <script src="/js/demo/slider.js"></script>
</html>   